kind: pipeline
name: default

steps:
- name: build
  image: golang:1.13
  commands:
  - make build_linux_amd64

- name: event promote
  image: golang:1.13
  commands:
  - echo "promote"
  when:
    event:
    - promote
    
- name: event rollback
  image: golang:1.13
  commands:
  - echo "rollback"
  when:
    event:
    - rollback
    
- name: target staging
  image: golang:1.13
  commands:
  - echo "rollback"
  when:
    target:
    - staging
    
- name: target production
  image: golang:1.13
  commands:
  - echo "rollback"
  when:
    target:
    - production

- name: docker
  image: plugins/docker
  settings:
    registry: docker.pkg.github.com
    repo: docker.pkg.github.com/appleboy/test/helloworld
    auto_tag: true
    auto_tag_suffix: linux-amd64
    username: appleboy
    password:
      from_secret: docker_password
  when:
    target:
    - production
